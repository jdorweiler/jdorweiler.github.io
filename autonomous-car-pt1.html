<!DOCTYPE html>
<html lang="en">
<head>
	<title>Autonomous Car pt.1</title>
	<meta charset="utf-8" />
	<meta name="author" content="Jason Dorweiler" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- JS Libraries to Load -->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://www.transistor.io/theme/js/bootstrap.min.js"></script>
	<script src="http://www.transistor.io/theme/js/progressbars.js"></script>
	
	
	<!-- CSS Styles -->
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/bootstrap.simplex.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/bootstrap-responsive.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/main.css" type="text/css">
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/pygment.css" type="text/css">
	<!--[if IE 7]>
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/font-awesome-ie7.min.css">
	<![endif]-->
	
	<!-- Feed Information / Copied from Simple Theme -->
	<link href="http://www.transistor.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="transistor.io Full Atom Feed" />
	<link href="http://www.transistor.io/feeds/Projects.atom.xml" type="application/atom+xml" rel="alternate" title="transistor.io Categories Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41941180-1', 'transistor.io');
  ga('send', 'pageview');

</script>

<link href="//vjs.zencdn.net/4.4/video-js.css" rel="stylesheet">
<script src="//vjs.zencdn.net/4.4/video.js"></script>
<style>
.video-js {padding-top: 56.25%}
.vjs-fullscreen {padding-top: 0px}
</style>

</head>
<body>
<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container pull-left offset1">
			<a class="btn btn-navbar clearfix pull-right" data-target=".navbar-responsive-collapse" data-toggle="collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>
			<a class="brand" href="http://www.transistor.io/index.html">transistor.io </a>
			
			<div class="nav-collapse collapse navbar-responsive-collapse">
				<ul class="nav">
					<li>
						<a href="http://www.transistor.io/pages/about-me.html"><i class="icon-user" ></i>About me</a>
					</li>
					<li class="divider-vertical"></li>
					<li >
						<a href="http://www.transistor.io/category/chemistry.html"><i class="icon-folder-open icon-large"></i> Chemistry</a>
					</li>
					<li class="divider-vertical"></li>
					<li >
						<a href="http://www.transistor.io/category/climbing.html"><i class="icon-folder-open icon-large"></i> Climbing</a>
					</li>
					<li class="divider-vertical"></li>
					<li class="active">
						<a href="http://www.transistor.io/category/projects.html"><i class="icon-folder-open icon-large"></i> Projects</a>
					</li>
					<li class="divider-vertical"></li>
				<li >
					<a href="http://www.transistor.io/archives.html"><i class="icon-th-list"></i> Archives</a>
				</li>
				
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="container-fluid" id="content">
	<div class="row-fluid">
		<div class="span1"></div>
		<div class="span10">
			<div class="row">
				<div class="offset1 span8">
<section id="content">
<article>
	<header>
			<h1>
					<a href=""
							rel="bookmark"
							title="Permalink to Autonomous Car pt.1">
							Autonomous Car pt.1
					</a>
			</h1>
	</header>
	
	<div class="entry-content">
	
	<div class="well">
<div class="row-fuild">
	<div class="span6">
	<span class="label text-center">Date</span>
	<abbr class="published" title="2012-06-05T00:00:00">
		<i class="icon-calendar"></i>Tue 05 June 2012
	</abbr>
	</div>
	<div class="span1">&nbsp;</div>
	<div class="span5">
		<span class="label text-center">Tags</span>
			<a href="http://www.transistor.io/tag/arduino.html">arduino</a>
			<a href="http://www.transistor.io/tag/robotics.html">robotics</a>
			<a href="http://www.transistor.io/tag/programming.html">programming</a>
			<a href="http://www.transistor.io/tag/autonomous-car.html">autonomous car</a>
			<a href="http://www.transistor.io/tag/computer-vision.html">computer vision</a>
	</div>
</div>	</div>
	<p><img alt="" src="images/car/title_1.png" /> </p>
<p>This post will detail my plans and progress for an autonomous car. I’ll be using what I learned from
building the <a href="electronics.html#robot">balancing robot</a> and courses though <a href="http://www.udacity.com" target="_blank">Udacity</a> and <a href="http://mitx.mit.edu/" target="_blank">MITx</a>.
The goal is to take a small 1/10
remote controlled car and have it navigate a course on its own. To navigate the course, I plan to use an
Android phone, GPS, and an accelerometer/gyroscope. I will record a video stream through the phone
and then process it on my laptop using Python and the computer vision library <a href="http://opencv.willowgarage.com/wiki/" target="_blank">OpenCV</a>.
<br>
<br>
<strong> The Car </strong>
<br>
I chose a 1/10 scale car so that it would be large enough to hold all of the electronics. I was worried that
the cheaper and more common 1/16 scale cars would be too small. I found this car on Amazon for about
$100. Here are some pictures of it below. I've already started working on the electronics.
<br>
<br>
<div class="row">
<div class="span1">
</div>
<div class="span5">
<img alt="car1" src="images/car/car1.png" />
</div></p>
<div class="span5">

<p><img alt="car2" src="images/car/car2.png" /></p>
<p></div>
</div></p>
<p><strong>The Code</strong></p>
<p>Below is a block diagram I drew that shows my preliminary design for the software portion of the car. 
<div class="row">
<div class="span1">
</div>
<div class="span8">
<img alt="code" src="images/car/code.png" />
</div>
</div>
For the localization of the car I’ll be using a GPS sensor and accelerometer. First, the GPS will find the
starting coordinates of the car. Then the car will start moving, somewhat blindly at first. Once the car is
moving, data from the accelerometer and elapsed time can be used to calculate the velocity of the car.
These two measurements are then passed into a Kalman filter to improve the accuracy of the car’s
position.
<br>
<br>
At the same time, heading data from the GPS and gyroscope are passed into another Kalman filter to get
an accurate heading on the car. The position and heading data from the Kalman filters is then compared
to a GPS waypoint given to the sensor and motor control. Next, a heading toward the desired GPS
waypoint is calculated, and the appropriate signal is sent to the steering servo in order to point the car
in that direction.
<br>
<br>
While this process is occurring, the camera from the Android phone will stream images of the car’s path
back to my computer. On the computer, I will use Python and OpenCV to process the images. The
images will be processed looking for the edges of the road (width) and also looking for obstacles in from
of the car. Data from the OpenCV program will be sent back to the motor control, allowing the car to
deviate from its previously calculated heading and avoid objects that may get in the way.<br>
<br>
Below is the preliminary work I’ve done on the image processing. I’m using an app called Barnacle to set
up a local network between my phone and laptop and then sending the camera feed over HTTP. Then
I’m using Python to grab a snapshot of the camera feed. I’ll walk through the steps of the image
processing below. I’ll save the discussion of the theory and mathematics behind these processing
algorithms for another time and just stick with the results for now.
<br>
<br>
Here’s the original image on the left.  The first step is to convert it to grayscale, shown on the right. 
<br>
<br>
<div class="row">
<div class="span1">
</div>
 <div class="span5">
<img alt="road" src="images/car/road.png" />
</div></p>
<p><div class="span5">
<img alt="road2" src="images/car/road2.png" />
</div>
</div>
<br>
<br>
From the gray image I run a <a href="http://en.wikipedia.org/wiki/Gaussian_blur" target="_blank">Gaussian filter</a> to reduce the noise and avoid finding false lines later on in the processing  (not shown).  Then the result of the Gaussian filter is passed into a <a href="http://en.wikipedia.org/wiki/Canny_edge_detector" target="_blank">Canny edge detector</a> to locate the edges.<br />
<br>
<br>
<div class="row">
<div class="span2">
 </div>
 <div class="span5">
<img alt="road3" src="images/car/road3.png" />
</div>
</div>
<br>
<br>
From the Canny image, you can already see the outline of the road. But if you look closely at the Canny
image, you’ll notice that those aren’t quite continuous lines. There are spots where the line breaks,
which will make doing any useful mathematics on it later more difficult. To fix this issue and clean up the
image further, I’m applying a
<a href="http://en.wikipedia.org/wiki/Hough_transform" target="_blank">Hough transform</a> 
to the Canny output. This transform is fairly complicated,
but the quick summary is that it looks for sections in the image that aren’t continuous but that form part
of a larger line. For this part, I’m also giving it a theta angle to restrict which lines it returns.
<br>
<br>
<div class="row">
<div class="span2">
 </div>
 <div class="span5">
<img alt="road4" src="images/car/road4.png" />
</div>
</div>
<br>
<br>
That’s it for now.  From here I can make sure that the car stays in the middle of the road. 
<br>
 Next plans are to add <a href="http://en.wikipedia.org/wiki/Blob_detection" target="_blank">obstacle detection</a>. 
 <br>
 <br>
 <br>
 <br></p>
	</div><!-- /.entry-content -->
	<div class="comments">
	<h2>Comments !</h2>
			<div id="disqus_thread"></div>
			<script type="text/javascript">
        var disqus_shortname = 'jd-transistorio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
	</div>
</article>
</section>
				</div>
				<div class="span3">
<ul class="nav nav-list well sidebar">
	<li class="nav-header">
		<h4>
			<i class="icon-rss icon-large"></i> 
			RSS/Atom Feeds
		</h4>
	</li>
	<li>
		<a href="http://www.transistor.io/feeds/all.atom.xml" rel="alternate">
		<i class="icon-bookmark icon-large"></i>
		Atom Feed
		</a>
	</li>
	<li class="nav-header"><h4><i class="icon-external-link"></i>Blogroll</h4></li>
		<li><a href="http://www.theamphour.com/"><i class="icon-external-link"></i>The Amp Hour</a></li>
		<li><a href="http://www.hackaday.com"><i class="icon-external-link"></i>Hack A Day</a></li>
		<li><a href="http://dangerousprototypes.com/"><i class="icon-external-link"></i>Dangerous Prototypes</a></li>
	<li class="nav-header"><h4><i class="icon-home icon-large"></i> Social</h4></li>
		<li><a href="http://github.com/jdorweiler"><i class="icon-github icon-large"></i>GitHub</a></li>
		<li><a href="http://www.linkedin.com/profile/view?id=85206177&trk=nav_responsive_tab_profile_pic"><i class="icon-linkedin icon-large"></i>LinkedIn</a></li>
		<li><a href="https://twitter.com/jdorw"><i class="icon-twitter icon-large"></i>twitter</a></li>
	
	<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
	
	<li>
		<a href="http://www.transistor.io/category/chemistry.html">
		<i class="icon-folder-open icon-large"></i>
		Chemistry
		</a>
	</li>
	<li>
		<a href="http://www.transistor.io/category/climbing.html">
		<i class="icon-folder-open icon-large"></i>
		Climbing
		</a>
	</li>
	<li>
		<a href="http://www.transistor.io/category/projects.html">
		<i class="icon-folder-open icon-large"></i>
		Projects
		</a>
	</li>
	
	<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/carbon-fiber.html">
        <i class="icon-tag icon-large"></i>carbon fiber
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/balancing-robot.html">
        <i class="icon-tag icon-large"></i>balancing robot
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/arduino.html">
        <i class="icon-tag icon-large"></i>arduino
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/electroncis.html">
        <i class="icon-tag icon-large"></i>electroncis
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/robotics.html">
        <i class="icon-tag icon-large"></i>robotics
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/biking.html">
        <i class="icon-tag icon-large"></i>biking
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/ros.html">
        <i class="icon-tag icon-large"></i>ros
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/rock-climbing.html">
        <i class="icon-tag icon-large"></i>rock climbing
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/pcb.html">
        <i class="icon-tag icon-large"></i>PCB
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/turtlebot.html">
        <i class="icon-tag icon-large"></i>turtlebot
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/hackaday.html">
        <i class="icon-tag icon-large"></i>hackaday
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/chemistry.html">
        <i class="icon-tag icon-large"></i>chemistry
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/roomba.html">
        <i class="icon-tag icon-large"></i>roomba
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/computer-vision.html">
        <i class="icon-tag icon-large"></i>computer vision
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/autonomous-car.html">
        <i class="icon-tag icon-large"></i>autonomous car
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/programming.html">
        <i class="icon-tag icon-large"></i>programming
		</a>
	</li>
</ul>
				</div>
			</div>
		</div>
		<div class="span1"></div>
	</div>
</div>

<footer class="navbar-fixed-bottom text-center">
Copyright &copy; 2014 by Jason Dorweiler
</footer>
</body>
</html>