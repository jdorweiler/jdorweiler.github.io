<!DOCTYPE html>
<html lang="en">
<head>
	<title>UGV Board for the Autonomous Car</title>
	<meta charset="utf-8" />
	<meta name="author" content="Jason Dorweiler" />
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	
	<!-- JS Libraries to Load -->
	<script src="http://code.jquery.com/jquery-1.9.1.min.js"></script>
	<script src="http://www.transistor.io/theme/js/bootstrap.min.js"></script>
	<script src="http://www.transistor.io/theme/js/progressbars.js"></script>
	
	
	<!-- CSS Styles -->
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/bootstrap.simplex.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/bootstrap-responsive.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/font-awesome.min.css" type="text/css" />
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/main.css" type="text/css">
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/pygment.css" type="text/css">
	<!--[if IE 7]>
	<link rel="stylesheet" href="http://www.transistor.io/theme/css/font-awesome-ie7.min.css">
	<![endif]-->
	
	<!-- Feed Information / Copied from Simple Theme -->
	<link href="http://www.transistor.io/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="transistor.io Full Atom Feed" />
	<link href="http://www.transistor.io/feeds/Projects.atom.xml" type="application/atom+xml" rel="alternate" title="transistor.io Categories Atom Feed" />

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41941180-1', 'transistor.io');
  ga('send', 'pageview');

</script>

<link href="//vjs.zencdn.net/4.4/video-js.css" rel="stylesheet">
<script src="//vjs.zencdn.net/4.4/video.js"></script>
<style>
.video-js {padding-top: 56.25%}
.vjs-fullscreen {padding-top: 0px}
</style>

</head>
<body>
<div class="navbar navbar-fixed-top">
	<div class="navbar-inner">
		<div class="container pull-left offset1">
			<a class="btn btn-navbar clearfix pull-right" data-target=".navbar-responsive-collapse" data-toggle="collapse">
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
				<span class="icon-bar"></span>
			</a>
			<a class="brand" href="http://www.transistor.io/index.html">transistor.io </a>
			
			<div class="nav-collapse collapse navbar-responsive-collapse">
				<ul class="nav">
					<li>
						<a href="http://www.transistor.io/pages/about-me.html"><i class="icon-user" ></i>About me</a>
					</li>
					<li class="divider-vertical"></li>
					<li >
						<a href="http://www.transistor.io/category/chemistry.html"><i class="icon-folder-open icon-large"></i> Chemistry</a>
					</li>
					<li class="divider-vertical"></li>
					<li >
						<a href="http://www.transistor.io/category/climbing.html"><i class="icon-folder-open icon-large"></i> Climbing</a>
					</li>
					<li class="divider-vertical"></li>
					<li class="active">
						<a href="http://www.transistor.io/category/projects.html"><i class="icon-folder-open icon-large"></i> Projects</a>
					</li>
					<li class="divider-vertical"></li>
				<li >
					<a href="http://www.transistor.io/archives.html"><i class="icon-th-list"></i> Archives</a>
				</li>
				
				</ul>
			</div>
		</div>
	</div>
</div>
<div class="container-fluid" id="content">
	<div class="row-fluid">
		<div class="span1"></div>
		<div class="span10">
			<div class="row">
				<div class="offset1 span8">
<section id="content">
<article>
	<header>
			<h1>
					<a href=""
							rel="bookmark"
							title="Permalink to UGV Board for the Autonomous Car">
							UGV Board for the Autonomous Car
					</a>
			</h1>
	</header>
	
	<div class="entry-content">
	
	<div class="well">
<div class="row-fuild">
	<div class="span6">
	<span class="label text-center">Date</span>
	<abbr class="published" title="2012-11-24T00:00:00">
		<i class="icon-calendar"></i>Sat 24 November 2012
	</abbr>
	</div>
	<div class="span1">&nbsp;</div>
	<div class="span5">
		<span class="label text-center">Tags</span>
			<a href="http://www.transistor.io/tag/pcb.html">PCB</a>
			<a href="http://www.transistor.io/tag/autonomous-car.html">autonomous car</a>
			<a href="http://www.transistor.io/tag/robotics.html">robotics</a>
	</div>
</div>	</div>
	<p><img alt="" src="images/UGV/title.png" /></p>
<p>UGV Board v1.1
 <p>Unmanned Ground Vehicle board for the ChipKit Max32</p>
 The UGV board is my attempt to put together all the things I found useful in building my <a href="http://jdorweiler.github.io/site2/tag/autonomous-car.html">autonomous car</a> and a few new features that I thought would be good to have.  As always you can find the latest source files for all my work on my <a href="https://github.com/jdorweiler"target="_blank">Github page</a>.  The goal was to build a board that will work well with my autonomous car setup but also have the ability to adapt for use in other autonomous robotics projects.
<br>
<br>
<div class="row">
<div class="span1">
</div>
<div class="span8">
<img alt="eagle" src="images/UGV/eaglebrd.png" />
</div>
</div>
<br>
At the time of writing this the UGV v1.1 has the following features. </p>
<ul>
<li>
<p>Onboard gyroscope</p>
</li>
<li>
<p>MicroSD card</p>
</li>
<li>
<p>Breakout for a GPS antenna </p>
</li>
<li>
<p>Breakout of an external LCD attached with the same ribbon connector used in the autonomous car</p>
</li>
<li>
<p>Xbee radio</p>
</li>
<li>
<p>Two breakouts designed for encoders with built-in hysteresis using 555 timers and LEDs to show each encoder tick</p>
</li>
<li>
<p>Breakout for four analog sensor pins.  Powered off the +5V rail. </p>
</li>
<li>
<p>Breakout for six servo/esc pins powered off an externally supplied voltage (determined by the user) and a large low ESR capacitorto prevent large voltage drops </p>
</li>
</ul>
<p><br>
<br>
<div class="row">
<div class="span1">
</div>
<div class="span8">
<img alt="board" src="images/UGV/UGVBoard.png" />
</div>
</div>
<br>
The un-assembled board.  These were made using the <a href="http://www.oshpark.com" target="_blank">OSH Park</a> board printing service and turned out looking great.  Below is the board after assembly.  I went with 0402 (0.4 mm × 0.2 mm) for many of the SMT components which I found out is really pushing the limit of soldering without a microscope. 
<br>
<br>
<div class="row">
<div class="span1">
</div>
<div class="span8">
<img alt="board2" src="images/UGV/UGVBoard2.png" />
</div>
</div>
<br>
The good part is that everything works! (after a few small modifications...)  I forgot to connect the CS and SDO pins on the gyroscope to the input voltage.  The CS pin needs to be pulled high to select the I<sup>2</sup>C interface and the SDO pin needs to be pulled high to select the chips address, 105 in this case.  I ended up having to hand solder a single copper strand from these pins to one of the nearby +3.3V vias to pull them up.  You can see it sticking out from under the Xbee in the picture above.  And for some reason the SD card holder's ground pins didn't get connected to the ground fill.  Not sure how that happened but it was a pretty easy fix.  I made a short video (below) showing the board working.  The blue LEDs show each encoder tick.  Toward the end of the video the LCD is showing the car's heading (corrected by the gyroscope) and interrupt counts from the wheel encoders. 
<br>
<div class="row">
<div class="span2">
</div>
<div class="span6">
<iframe width="560" height="315" src="http://www.youtube.com/embed/MIwUdI9IMPc" frameborder="0" allowfullscreen></iframe>
</div>
</div>
<br>
<br>
Here's a schematic for the UGV Board (click for a larger image).
<br>
<div class="row">
<div class="span2">
</div>
<div class="span9">
<a href="https://raw.github.com/jdorweiler/Autonomous-Car/master/autonomous%20car%20schematic.png"><img alt="alt text" src="images/car/autonomouscarschematic.png" /></a>
</div>
</div></p>
<h3>Autonomous Car GUI</h3>

<p>I've had a bit of free time while I waited for the boards to be printed.  I decided to take that time to finally
work on a GUI ground station to control the car from a laptop.  I'd been a bit apprehensive to start on this portion of the project because I really knew almost nothing about making a GUI and the whole idea seemed a bit daunting to me but it's something that would make a great addition to the project.  I decided to write the GUI using Processing since it’s pretty much just C++ code.  It turned out looking great. </p>
<p>Below is a screen shot of the GUI.  There's a still a lot of work to be done but I think I'm off to a good start.
I've made a few changed to the autonomous car code to accommodate the new GUI.  Here’s how the whole things works now. </p>
<p>After turning the car on it will 
sit and wait until either a start button on the car is manually pushed or it receives a start character from the 
laptop over the Xbee radios.  Once the car is running it sends back data at a user defined time interval currently
set to 100 ms.  A sync character is sent from the car to tell the computer that there’s a new data coming in. 
On the other end the data gets parsed, stored into its appropriate variable and plotted. 
I've got it set up to plot the velocity/acceleration calculated from the wheel encoders
and the distance from the waypoint on one graph.  The lower graph shows the steering angle error or how far the
steering angle differs from the desired calculated angle.  This will give a good visual for how well the PID gains are set up. 
<br>
<br>
<div class="row">
<div class="span1">
</div>
<div class="span8">
<img alt="gui" src="images/UGV/GUI.png" />
</div>
</div>
<br>
The numbers on the screen are actual test data being sent from the car using the Xbee radios just to check that the data parsing is working.  I've also added in some sliders to adjust the PID settings on the car.  The idea being 
that I could changed the gains based on how the steering error plot is looking.  This would give me a much easier 
way to tune the PID algorithm as the car is running versus having to stop it and upload the firmware on the board
for each change.  I also plan on doing the same to control the car's speed.  On the car's code I set up a timer 
interrupt to go off every 500 ms to check the serial line looking for new settings or watch for a stop command sent from the laptop. Since the car will be controlled only by the laptop I'm also planning on adding a radio signal connection/strength monitor.  This will act as switch to shut the car off if it goes out of radio contact.</p>
	</div><!-- /.entry-content -->
	<div class="comments">
	<h2>Comments !</h2>
			<div id="disqus_thread"></div>
			<script type="text/javascript">
        var disqus_shortname = 'jd-transistorio'; // required: replace example with your forum shortname

        /* * * DON'T EDIT BELOW THIS LINE * * */
        (function() {
            var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
            dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
            (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
        })();
    </script>
    <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
    <a href="http://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
    
	</div>
</article>
</section>
				</div>
				<div class="span3">
<ul class="nav nav-list well sidebar">
	<li class="nav-header">
		<h4>
			<i class="icon-rss icon-large"></i> 
			RSS/Atom Feeds
		</h4>
	</li>
	<li>
		<a href="http://www.transistor.io/feeds/all.atom.xml" rel="alternate">
		<i class="icon-bookmark icon-large"></i>
		Atom Feed
		</a>
	</li>
	<li class="nav-header"><h4><i class="icon-external-link"></i>Blogroll</h4></li>
		<li><a href="http://www.theamphour.com/"><i class="icon-external-link"></i>The Amp Hour</a></li>
		<li><a href="http://www.hackaday.com"><i class="icon-external-link"></i>Hack A Day</a></li>
		<li><a href="http://dangerousprototypes.com/"><i class="icon-external-link"></i>Dangerous Prototypes</a></li>
	<li class="nav-header"><h4><i class="icon-home icon-large"></i> Social</h4></li>
		<li><a href="http://github.com/jdorweiler"><i class="icon-github icon-large"></i>GitHub</a></li>
		<li><a href="http://www.linkedin.com/profile/view?id=85206177&trk=nav_responsive_tab_profile_pic"><i class="icon-linkedin icon-large"></i>LinkedIn</a></li>
		<li><a href="https://twitter.com/jdorw"><i class="icon-twitter icon-large"></i>twitter</a></li>
	
	<li class="nav-header"><h4><i class="icon-folder-close icon-large"></i>Categories</h4></li>
	
	<li>
		<a href="http://www.transistor.io/category/chemistry.html">
		<i class="icon-folder-open icon-large"></i>
		Chemistry
		</a>
	</li>
	<li>
		<a href="http://www.transistor.io/category/climbing.html">
		<i class="icon-folder-open icon-large"></i>
		Climbing
		</a>
	</li>
	<li>
		<a href="http://www.transistor.io/category/projects.html">
		<i class="icon-folder-open icon-large"></i>
		Projects
		</a>
	</li>
	
	<li class="nav-header"><h4><i class="icon-tags icon-large"></i>Tags</h4></li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/carbon-fiber.html">
        <i class="icon-tag icon-large"></i>carbon fiber
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/balancing-robot.html">
        <i class="icon-tag icon-large"></i>balancing robot
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/arduino.html">
        <i class="icon-tag icon-large"></i>arduino
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/electroncis.html">
        <i class="icon-tag icon-large"></i>electroncis
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/robotics.html">
        <i class="icon-tag icon-large"></i>robotics
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/biking.html">
        <i class="icon-tag icon-large"></i>biking
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/ros.html">
        <i class="icon-tag icon-large"></i>ros
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/rock-climbing.html">
        <i class="icon-tag icon-large"></i>rock climbing
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/pcb.html">
        <i class="icon-tag icon-large"></i>PCB
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/turtlebot.html">
        <i class="icon-tag icon-large"></i>turtlebot
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/hackaday.html">
        <i class="icon-tag icon-large"></i>hackaday
		</a>
	</li>
	<li class="tag-4">
		<a href="http://www.transistor.io/tag/chemistry.html">
        <i class="icon-tag icon-large"></i>chemistry
		</a>
	</li>
	<li class="tag-3">
		<a href="http://www.transistor.io/tag/roomba.html">
        <i class="icon-tag icon-large"></i>roomba
		</a>
	</li>
	<li class="tag-2">
		<a href="http://www.transistor.io/tag/computer-vision.html">
        <i class="icon-tag icon-large"></i>computer vision
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/autonomous-car.html">
        <i class="icon-tag icon-large"></i>autonomous car
		</a>
	</li>
	<li class="tag-1">
		<a href="http://www.transistor.io/tag/programming.html">
        <i class="icon-tag icon-large"></i>programming
		</a>
	</li>
</ul>
				</div>
			</div>
		</div>
		<div class="span1"></div>
	</div>
</div>

<footer class="navbar-fixed-bottom text-center">
Copyright &copy; 2014 by Jason Dorweiler
</footer>
</body>
</html>